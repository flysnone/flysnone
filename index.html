<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>러시안 룰렛</title>
    <style>
        /* 스타일은 이전과 동일 */
    </style>
</head>
<body>

    <div class="container">
        <h1>러시안 룰렛</h1>
        <div id="mode-selection">
            <button class="button" onclick="startGame(1)">1. 매번 약실을 돌리는 룰렛</button>
            <button class="button" onclick="startGame(2)">2. 약실을 돌리지 않는 룰렛</button>
            <button class="button" onclick="startGame(3)">3. 매번 약실에 총알을 채우는 룰렛</button>
        </div>
        <div id="game" class="hidden">
            <div id="status" class="status">
                <p>시행 횟수: <span id="round-count">0</span></p>
            </div>
            <div id="bullet-status" class="bullet-status"></div>
            <button id="trigger-btn" class="game-btn" onclick="fireTrigger()">방아쇠 당기기</button>
        </div>
    </div>

    <script>
        let mode;
        let survivedCount = 0;
        let currentChamber = 1;
        let bullets = 1;
        let roundCount = 0;
        let emptyChambers = 0;
        let isModeOne = true;
        const totalChambers = 6;

        function startGame(selectedMode) {
            mode = selectedMode;
            survivedCount = 0;
            currentChamber = 1;
            bullets = 1;
            roundCount = 0;
            emptyChambers = 0;
            isModeOne = true;
            updateStatus();
            updateBulletStatus();
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            alert('게임이 시작되었습니다! 방아쇠를 당겨주세요.');
        }

        function fireTrigger() {
            roundCount++;
            let shot;
            switch(mode) {
                case 1:
                    if (isModeOne) {
                        shot = Math.floor(Math.random() * 6) + 1;
                        if (roundCount <= 5) {
                            if (shot === 6) {
                                gameOver('빵!');
                            } else {
                                survivedCount++;
                                alert('딸깍...');
                            }
                        } else {
                            alert('조금 지루한 감이 없지 않아 있네요. 그럼 이제 확률을 뒤집어 볼까요? 살 확률은 6분의 1, 죽을 확률은 6분의 5. 자, 다시 시작하겠습니다. 속도를 높여 볼까요?');
                            isModeOne = false;
                        }
                    } else {
                        shot = Math.floor(Math.random() * 6) + 1;
                        if (shot <= 5) {
                            gameOver('빵!');
                        } else {
                            alert('딸깍...');
                        }
                    }
                    break;
                case 2:
                    shot = Math.floor(Math.random() * (totalChambers - emptyChambers)) + 1;
                    if (shot === 1) {
                        gameOver('빵!');
                    } else {
                        currentChamber++;
                        emptyChambers++;
                        alert('딸깍...');
                    }
                    break;
                case 3:
                    if (bullets <= totalChambers) {
                        shot = Math.floor(Math.random() * totalChambers) + 1;
                        if (shot <= bullets) {
                            gameOver('빵!');
                        } else {
                            bullets++;
                            alert('딸깍...');
                        }
                    } else {
                        gameOver('모든 총알이 다 들어갔습니다!');
                    }
                    break;
            }
            updateStatus();
            updateBulletStatus();
        }

        function updateStatus() {
            document.getElementById('round-count').textContent = roundCount;
        }

        function updateBulletStatus() {
            const bulletContainer = document.getElementById('bullet-status');
            bulletContainer.innerHTML = '';

            for (let i = 0; i < totalChambers; i++) {
                const chamber = document.createElement('div');
                chamber.classList.add('chamber');

                // 모드 1-1 (초기 단계): 총알을 1/6 확률로 넣기
                if (isModeOne && roundCount <= 5 && i < 1) {
                    chamber.classList.add('bullet');
                } 
                // 모드 1-2 (확률 뒤집힌 후): 총알을 5/6 확률로 넣기
                else if (isModeOne && roundCount > 5 && i < 5) {
                    chamber.classList.add('bullet');
                }
                // 모드 2, 3에서의 총알 상태
                else if (mode === 2 && i < 5) {
                    chamber.classList.add('empty');
                } 
                else if (mode === 3 && i < bullets) {
                    chamber.classList.add('bullet');
                } else {
                    chamber.classList.add('empty');
                }
                bulletContainer.appendChild(chamber);
            }
        }

        function gameOver(message) {
            const gameOverScreen = document.createElement('div');
            gameOverScreen.classList.add('game-over');
            gameOverScreen.textContent = message;
            document.body.appendChild(gameOverScreen);

            document.getElementById('trigger-btn').disabled = true;
        }
    </script>
</body>
</html>